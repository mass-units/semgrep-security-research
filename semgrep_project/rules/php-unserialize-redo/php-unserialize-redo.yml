rules:
- id: php-unserialize-redo
  patterns:
    pattern-either:
      - pattern: |
          class $C
          {
            ...
            function __construct()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __destruct()
            {
              ...
              unlink(...);
              ...
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __call()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __callStatic()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __get()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __set()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __isset()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __unset()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __sleep()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __wakeup()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __serialize()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __unserialize()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __toString()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __invoke()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __set_state()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __clone()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __debugInfo()
            {
              ...
              unlink(...);
              ...
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __construct()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __destruct()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __call()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __callStatic()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __get()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __set()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __isset()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __unset()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __sleep()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __wakeup()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __serialize()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __unserialize()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __toString()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __invoke()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __set_state()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __clone()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
      - pattern: |
          class $C
          {
            ...
            function __debugInfo()
            {
              ...
              eval(...);
            }
            ...
          }
          ...
          $A = unserialize(...);
  message: PHP unserialize with magic function and possible POP chain - possible object injection. 
  languages: [php]
  severity: ERROR
